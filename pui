-- 修复版 DrRay UI (pui.lua)，支持横向滚动的 Tab 栏
-- 原作者代码基础上添加 ScrollingFrame 用于 TabContainer

local DrRayLibrary = {}

function DrRayLibrary:Load(title, theme)
    local player = game.Players.LocalPlayer
    local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
    gui.Name = "DrRayUI"

    local main = Instance.new("Frame", gui)
    main.Name = "Main"
    main.Size = UDim2.new(0, 600, 0, 400)
    main.Position = UDim2.new(0.5, -300, 0.5, -200)
    main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    main.BorderSizePixel = 0

    local titleLabel = Instance.new("TextLabel", main)
    titleLabel.Size = UDim2.new(1, 0, 0, 30)
    titleLabel.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    titleLabel.Text = title or "DrRay"
    titleLabel.TextColor3 = Color3.new(1,1,1)
    titleLabel.TextSize = 20
    titleLabel.Font = Enum.Font.SourceSansBold

    -- ✅ 滚动的 TabContainer
    local TabContainer = Instance.new("ScrollingFrame", main)
    TabContainer.Name = "TabContainer"
    TabContainer.BackgroundTransparency = 1
    TabContainer.Size = UDim2.new(1, 0, 0, 40)
    TabContainer.Position = UDim2.new(0, 0, 0, 30)
    TabContainer.ScrollBarThickness = 6
    TabContainer.ScrollingDirection = Enum.ScrollingDirection.X
    TabContainer.HorizontalScrollBarInset = Enum.ScrollBarInset.Always
    TabContainer.CanvasSize = UDim2.new(5, 0, 0, 40)
    TabContainer.AutomaticCanvasSize = Enum.AutomaticSize.X

    local TabLayout = Instance.new("UIListLayout", TabContainer)
    TabLayout.FillDirection = Enum.FillDirection.Horizontal
    TabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    TabLayout.Padding = UDim.new(0, 5)

    -- 内容区
    local Pages = Instance.new("Frame", main)
    Pages.Name = "Pages"
    Pages.Position = UDim2.new(0, 0, 0, 70)
    Pages.Size = UDim2.new(1, 0, 1, -70)
    Pages.BackgroundTransparency = 1

    local pagesFolder = Instance.new("Folder", Pages)
    pagesFolder.Name = "PagesFolder"

    function DrRayLibrary.newTab(tabName, imageId)
        local tabButton = Instance.new("TextButton", TabContainer)
        tabButton.Size = UDim2.new(0, 100, 1, 0)
        tabButton.Text = tabName
        tabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        tabButton.TextColor3 = Color3.new(1, 1, 1)
        tabButton.Font = Enum.Font.SourceSans
        tabButton.TextSize = 16

        local tabPage = Instance.new("Frame", pagesFolder)
        tabPage.Name = tabName
        tabPage.Size = UDim2.new(1, 0, 1, 0)
        tabPage.Visible = false
        tabPage.BackgroundTransparency = 1

        local layout = Instance.new("UIListLayout", tabPage)
        layout.Padding = UDim.new(0, 6)
        layout.SortOrder = Enum.SortOrder.LayoutOrder

        tabButton.MouseButton1Click:Connect(function()
            for _, page in ipairs(pagesFolder:GetChildren()) do
                page.Visible = false
            end
            tabPage.Visible = true
        end)

        -- 默认显示第一个Tab
        if #pagesFolder:GetChildren() == 1 then
            tabPage.Visible = true
        end

        local api = {}

        function api.newLabel(text)
            local lbl = Instance.new("TextLabel", tabPage)
            lbl.Text = text
            lbl.Size = UDim2.new(1, -10, 0, 25)
            lbl.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
            lbl.TextColor3 = Color3.new(1, 1, 1)
            lbl.Font = Enum.Font.SourceSans
            lbl.TextSize = 16
        end

        function api.newButton(text, desc, callback)
            local btn = Instance.new("TextButton", tabPage)
            btn.Text = text
            btn.Size = UDim2.new(1, -10, 0, 30)
            btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            btn.TextColor3 = Color3.new(1, 1, 1)
            btn.Font = Enum.Font.SourceSans
            btn.TextSize = 16
            btn.MouseButton1Click:Connect(callback)
        end

        function api.newToggle(name, desc, default, callback)
            local toggle = Instance.new("TextButton", tabPage)
            toggle.Size = UDim2.new(1, -10, 0, 30)
            toggle.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
            toggle.TextColor3 = Color3.new(1, 1, 1)
            toggle.Font = Enum.Font.SourceSans
            toggle.TextSize = 16
            local state = default
            toggle.Text = name .. ": " .. (state and "✔️" or "❌")
            toggle.MouseButton1Click:Connect(function()
                state = not state
                toggle.Text = name .. ": " .. (state and "✔️" or "❌")
                callback(state)
            end)
        end

        function api.newInput(name, desc, callback)
            local txtbox = Instance.new("TextBox", tabPage)
            txtbox.PlaceholderText = name
            txtbox.Size = UDim2.new(1, -10, 0, 30)
            txtbox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            txtbox.TextColor3 = Color3.new(1, 1, 1)
            txtbox.Font = Enum.Font.SourceSans
            txtbox.TextSize = 16
            txtbox.FocusLost:Connect(function(enter)
                if enter then
                    callback(txtbox.Text)
                end
            end)
        end

        function api.newDropdown(name, desc, items, callback)
            local btn = Instance.new("TextButton", tabPage)
            btn.Size = UDim2.new(1, -10, 0, 30)
            btn.BackgroundColor3 = Color3.fromRGB(65, 65, 65)
            btn.TextColor3 = Color3.new(1, 1, 1)
            btn.Font = Enum.Font.SourceSans
            btn.TextSize = 16
            btn.Text = name .. " ▼"
            local selected = nil

            local function updateText()
                btn.Text = name .. ": " .. (selected or "请选择")
            end

            btn.MouseButton1Click:Connect(function()
                local popup = Instance.new("Frame", btn)
                popup.Size = UDim2.new(1, 0, 0, #items * 25)
                popup.Position = UDim2.new(0, 0, 1, 0)
                popup.BackgroundColor3 = Color3.fromRGB(70, 70, 70)

                for _, item in ipairs(items) do
                    local opt = Instance.new("TextButton", popup)
                    opt.Size = UDim2.new(1, 0, 0, 25)
                    opt.Text = item
                    opt.TextColor3 = Color3.new(1, 1, 1)
                    opt.BackgroundColor3 = Color3.fromRGB(75, 75, 75)
                    opt.Font = Enum.Font.SourceSans
                    opt.TextSize = 14
                    opt.MouseButton1Click:Connect(function()
                        selected = item
                        callback(item)
                        updateText()
                        popup:Destroy()
                    end)
                end
            end)

            function btn:Refresh(newList)
                items = newList
                updateText()
            end

            updateText()
            return btn
        end

        return api
    end

    return DrRayLibrary
end

return DrRayLibrary
